# Chess.com 対戦相手の国マップ

Chess.comの対戦履歴を分析し、対戦相手の国を世界地図上に表示するWebアプリケーションです。

## 機能

- **コマンドライン起動**: サーバー起動時にChess.comユーザー名を入力
- **既存データの自動読み込み**: 起動時に保存済みデータを地図上に表示
- **Chess.com APIデータ取得**: 対戦履歴と対戦相手の国情報を自動取得
- **インタラクティブ地図**: OpenStreetMapとLeafletによる世界地図表示
- **国旗表示**:
  Chess.com特有コード（XE/XS/XW/XB/XC/XT）を含む包括的な国旗サポート
- **対戦相手国一覧**: 国名、国コード、対戦数を表示
- **期間選択**: チェックボックス形式で複数期間を選択可能
- **地図クリック機能**: 国をクリックしてマーカーとポップアップを表示
- **効率的なデータ保存**: ローカルディスクへの階層化ファイル管理

## Chess.com特有コードサポート

本アプリは標準ISO国コードに加え、Chess.com特有の地域コードをサポートしています：

- **XE**: イングランド 🏴󠁧󠁢󠁥󠁮󠁧󠁿
- **XS**: スコットランド 🏴󠁧󠁢󠁳󠁣󠁴󠁿
- **XW**: ウェールズ 🏴󠁧󠁢󠁷󠁬󠁳󠁿
- **XB**: ベルギー（Chess.comコード）🇧🇪
- **XC**: デンマーク（Chess.comコード）🇩🇰
- **XT**: 欧州全域 🇪🇺
- **XK**: コソボ 🇽🇰

## 使い方

1. ターミナルでプロジェクトディレクトリに移動
2. 以下のコマンドでDenoサーバーを起動:
   ```bash
   deno run --allow-net --allow-read --allow-write server.ts
   ```
3. プロンプトに従ってChess.comユーザー名を入力
4. ブラウザで http://localhost:8080 を開く
5. 既存データがある場合は自動で地図に表示されます
6. 新規データ取得時は表示される期間をチェックして「データを取得」をクリック
7. 国一覧から国をクリックして地図上にマーカーを表示
8. 地図上の国をクリックしてポップアップを表示

## 技術スタック

- **フロントエンド**: HTML/CSS/JavaScript（バニラJS）
- **バックエンド**: Deno + TypeScript
- **地図表示**: Leaflet.js
- **API**: Chess.com Public API
- **データ保存**: ローカルディスク（JSON）

## データ管理

- **アーカイブファイル**: `data/archives/username_YYYY_MM.json`
- **プレイヤーファイル**: `data/players/[a-z0-9other]/username.json`
- **キャッシュ管理**: 当月データは30分間隔、過去データは24時間有効
- **階層化ストレージ**: プレイヤーデータを初期文字別サブディレクトリに分散

## 特徴

- **オフライン優先**: 既存データを即座に表示し、必要に応じて更新
- **効率的API利用**: キャッシュ機能により不要なAPI呼び出しを削減
- **包括的地域サポート**: 標準国コードとChess.com特有コードの両方をサポート
- **ユーザーフレンドリー**: 起動時のデータ自動表示と直感的なUI操作
